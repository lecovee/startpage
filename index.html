<!DOCTYPE html>
 <html lang="en"  style="background-image: url('background/background1.jpg');background-size:cover"> 
  <head>
    <meta charset="UTF-8">
    <title>my home page</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta name="theme-color" content="#0019B5">
  </head>


  <body onload="checkGoogleApiKeySet()">
	<div class="row">
  		<a class="icon" href="https://smile.amazon.de/-/en/gp/video/storefront/ref=atv_nb_free_to_me?language=en">
    			<img class="image" src="thumbnails/amazon.svg" alt="amazon" style="width:100%">
  		</a>

  		<a class="icon" href="https://youtube.com">
    			<img class="image" src="thumbnails/youtube.svg" alt="youtube" style="width:100%">
  		</a>

  		<a class="icon" href="https://netflix.com">
    			<img class="image" src="thumbnails/netflix.svg" alt="netflix" style="width:100%">
  		</a>
  		
		<!--
		<a class="icon" href="https://www.youtube.com/embed/playlist?list=PL4A2F331EE86DCC22">
    			<img class="image" src="thumbnails/tagesschau.svg" alt="tagesschau" style="width:100%">
  		</a>
		-->
		
		
		<a class="icon" id="tagesschau" href="https://www.youtube.com/embed/videoseries?index=0&amp;list=PL4A2F331EE86DCC22">
    			<img class="image" id="tagesschauIcon" src="thumbnails/tagesschauInactive.svg" alt="tagesschau" style="width:100%">
  		</a>
	

		<!--
  		<a class="icon" href="https://www.twitch.tv">
    			<img class="image" src="thumbnails/twitch.svg" alt="twitch" style="width:100%">
  		</a>
		-->
		
		<!--
  		<a class="icon" href="https://www.ardmediathek.de/sendung/kevin-kuehnert-und-die-spd/staffel-1/Y3JpZDovL25kci5kZS80NzI4/1/">
    			<img class="image" src="thumbnails/miscellaneous.svg" alt="miscellaneous" style="width:100%">
  		</a>
		-->
		
		
  		<a class="icon" href="https://www.zdf.de/comedy/zdf-magazin-royale">
    			<img class="image" src="thumbnails/zdf_magazin.svg" alt="zdf magazin" style="width:100%">
  		</a>
	</div>
  </body>
  <script>
  	function setTagesschauLink(link){
  		var tagesschauIcon = document.getElementById("tagesschau");
  		tagesschauIcon.setAttribute("href",link);
  	}
	function setTagesschauIconReady(){
		$(document).ready(function() {
			document.getElementById("tagesschauIcon").src = "thumbnails/tagesschau.svg";
		});
	}
  	function getTagesschauQuery(){
  		var date = new Date();
  		date.setDate(date.getDate()-1); 
  		var dateString = getTwoDigitsValue(date.getDate())+"."+getTwoDigitsValue(date.getMonth()+1)+"."+date.getFullYear();
  		return "tagesschau+20:00+uhr+\""+dateString+"\"";
  	}
  	function getTwoDigitsValue(value){
  		if (value < 10){
  			answer = "0"+value;
  		} else {
  			answer = value;
  		}
  		return answer;	
  	}
	function updateTagesschauLink(googleApiKey) {
		var searchQuery = 
		$.get("https://www.googleapis.com/youtube/v3/search?part=snippet&q="+getTagesschauQuery()+"&key="+googleApiKey,function(data){
			var responseString = JSON.stringify(data);
			var videoId = responseString.substring(responseString.indexOf("videoId")+10,responseString.indexOf("videoId")+21);
	  		var link = "https://www.youtube.com/watch?v="+videoId
			if (videoId.length===11){
				setTagesschauLink(link);
				setTagesschauIconReady();
			}
		});
	}
	function checkGoogleApiKeySet() {
		googleApiKey = getCookie("googleApiKey");
		if (googleApiKey.length > 0) {
			updateTagesschauLink(googleApiKey);
		}
		else {
			let googleApiKey = prompt("enter my google api");
			document.cookie = "googleApiKey="+googleApiKey+";";
			updateTagesschauLink(googleApiKey);
		}
	}
	function getCookie(cname) {
		// from https://www.w3schools.com/js/js_cookies.asp
		let name = cname + "=";
		let decodedCookie = decodeURIComponent(document.cookie);
		let ca = decodedCookie.split(';');
		for(let i = 0; i <ca.length; i++) {
			let c = ca[i];
			while (c.charAt(0) == ' ') {
				c = c.substring(1);
			}
			if (c.indexOf(name) == 0) {
				return c.substring(name.length, c.length);
			}
		}
		return "";
	}
  </script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</body>
</html>
