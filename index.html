<!DOCTYPE html>
 <html lang="en"  style="background-image: url('background/background1.jpg');background-size:cover"> 
  <head>
    <meta charset="UTF-8">
    <title>my home page</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta name="theme-color" content="#0019B5">
  </head>


  <body onload="onload()">
	<div class="row">
  		<a class="icon" id="amazon" href="https://smile.amazon.de/-/en/gp/video/storefront/ref=atv_nb_free_to_me?language=en">
    			<img class="image" src="thumbnails/amazon.svg" alt="amazon" style="width:100%">
  		</a>

  		<a class="icon" href="https://youtube.com">
    			<img class="image" src="thumbnails/youtube.svg" alt="youtube" style="width:100%">
  		</a>

  		<a class="icon" href="https://netflix.com">
    			<img class="image" src="thumbnails/netflix.svg" alt="netflix" style="width:100%">
  		</a>
  				
		
		<a class="icon" id="tagesschau" href="https://www.youtube.com/embed/videoseries?index=0&amp;list=PL4A2F331EE86DCC22">
    			<img class="image" id="tagesschauImage" src="thumbnails/tagesschauInactive.svg" alt="tagesschau" style="width:100%">
  		</a>
	

		<!--
  		<a class="icon" href="https://www.twitch.tv">
    			<img class="image" src="thumbnails/twitch.svg" alt="twitch" style="width:100%">
  		</a>
		-->
		
		<!--
  		<a class="icon" href="https://www.ardmediathek.de/sendung/kevin-kuehnert-und-die-spd/staffel-1/Y3JpZDovL25kci5kZS80NzI4/1/">
    			<img class="image" src="thumbnails/miscellaneous.svg" alt="miscellaneous" style="width:100%">
  		</a>
		-->
		
  		<a class="icon" id="whatsapp" href="https://web.whatsapp.com">
    			<img class="image" src="thumbnails/whatsapp.svg" alt="whatsapp" style="width:100%">
  		</a>
		
  		<a class="icon" id="alternative" href="https://www.zdf.de/comedy/zdf-magazin-royale">
    			<img class="image" src="thumbnails/zdf_magazin.svg" alt="zdf magazin" style="width:100%">
  		</a>
	</div>
  </body>
  <script>
	//constants
	var googleApiKeyCookieName = "googleApiKey";
	var usageCookieName = "usage";
	var usageMedia = "media";
	var usageDesktop = "desktop";

	//main
	adjustForUse(getUsage());

	function onload(){
		// anscheinend geht $ nicht direkt aber über onload gehts
		// google api key exceeds mögliche lösung check nur höchsten x mal am tag und save last youtube id als cookie
		updateTagesschauLink(checkGoogleApiKeySet());
	}

	function getUsage(){
		thisUsage = getCookie(usageCookieName);
		if (thisUsage.length===0) {
			if (confirm("usage mainly as media (instead of desktop)")) {
				thisUsage = usageMedia;
			}
			else {
				thisUsage = usageDesktop;
			}
			setCookie(usageCookieName, thisUsage);
		}
		return thisUsage;
		
	}
	function adjustForUse(usage){
		if(usage===usageMedia){
			removeElement("whatsapp");			
			return;
		}
		else if (usage === usageDesktop){
			removeElement("alternative");
			document.getElementById("amazon").setAttribute("href","https://smile.amazon.de/");
			return;
		}
		else {
			alert("hi");
		}				
	}
	function removeElement(id) {
		document.getElementById(id).outerHTML = "";
	}
  	function setTagesschauLink(link){
  		let tagesschauIcon = document.getElementById("tagesschau");
  		tagesschauIcon.setAttribute("href",link);
  	}
	function setTagesschauImageReady(){
		$(document).ready(function() {
			document.getElementById("tagesschauImage").src = "thumbnails/tagesschau.svg";
		});
	}
  	function getTagesschauQuery(){
  		let date = new Date();
  		date.setDate(date.getDate()-1); 
  		let dateString = getTwoDigitsValue(date.getDate())+"."+getTwoDigitsValue(date.getMonth()+1)+"."+date.getFullYear();
  		return "tagesschau+20:00+uhr+\""+dateString+"\"";
  	}
  	function getTwoDigitsValue(value){
  		if (value < 10){
  			answer = "0"+value;
  		} else {
  			answer = value;
  		}
  		return answer;	
  	}
	function updateTagesschauLink(thisGoogleApiKey) {
		let searchQuery = 
		$.get("https://www.googleapis.com/youtube/v3/search?part=snippet&q="+getTagesschauQuery()+"&key="+thisGoogleApiKey,function(data){
			let responseString = JSON.stringify(data);
			let videoIdPosition = responseString.indexOf("videoId");
			let videoId = responseString.substring(videoIdPosition+10,videoIdPosition+21);
	  		let link = "https://www.youtube.com/watch?v="+videoId
			setTagesschauLink(link);
			setTagesschauImageReady();
		});
	}
	function checkGoogleApiKeySet() {
		let googleApiKey = getCookie(googleApiKeyCookieName);
		if (googleApiKey.length === 0) {
			googleApiKey = prompt("enter my google api");
			setCookie(googleApiKeyCookieName, googleApiKey);
		}
		return googleApiKey;
	}
	function setCookie(cookieName, cookieValue) {
		document.cookie = cookieName + "="+cookieValue+";";
	}
	function getCookie(cname) {
		// from https://www.w3schools.com/js/js_cookies.asp
		let name = cname + "=";
		let decodedCookie = decodeURIComponent(document.cookie);
		let ca = decodedCookie.split(';');
		for(let i = 0; i <ca.length; i++) {
			let c = ca[i];
			while (c.charAt(0) == ' ') {
				c = c.substring(1);
			}
			if (c.indexOf(name) == 0) {
				return c.substring(name.length, c.length);
			}
		}
		return "";
	}
  </script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</body>
</html>
